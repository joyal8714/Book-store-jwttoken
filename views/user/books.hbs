<h2 style="text-align: center; margin-top: 20px; font-size: 32px; color: #333;">📚 All Books</h2>

<div style="display: flex; justify-content: flex-end; margin: 20px;">
  <form action="/logout" method="GET" style="margin-right: 10px;">
    <button type="submit" style="background-color: #dc3545; color: white; padding: 8px 16px; border: none; border-radius: 5px; cursor: pointer;">Logout</button>
  </form>

  <a href="/cart" class="btn btn-success" style="background-color: #28a745; color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none;">🛒 View Cart</a>
</div>

<div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 30px; padding: 20px;">
  {{#each books}}
    <div style="background: #fff; box-shadow: 0 4px 8px rgba(0,0,0,0.1); padding: 15px; width: 220px; border-radius: 10px; text-align: center; transition: transform 0.3s;">
      <img src="/uploads/{{this.cover}}" alt="{{this.title}}" style="width: 100%; height: 180px; object-fit: cover; border-radius: 8px;">
      <h3 style="font-size: 18px; margin: 10px 0 5px;">{{this.title}}</h3>
      <small style="color: #777;">by {{this.author}}</small>
      <p style="color: #28a745; font-weight: bold; margin-top: 8px;">₹{{this.price}}</p>

      {{#if (eq ../user.role "admin")}}
        <a href="/admin/edit-book/{{this._id}}">
          <button style="margin-top: 10px; background-color: #007bff; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer;">✏️ Edit</button>
        </a>
        <form action="/admin/delete-book/{{this._id}}" method="POST" style="margin-top: 8px;" onsubmit="return confirm('Are you sure you want to delete this book?')">
          <input type="hidden" name="returnTo" value="/books" />
          <button type="submit" style="background-color: #f8d7da; color: #dc3545; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer;">🗑️ Delete</button>
        </form>
      {{/if}}

   {{#if (eq ../user.role "user")}}
  <form onsubmit="return addToCart(event, '{{this._id}}')" style="margin-top: 10px;">
    <button type="submit" class="add-cart-btn" id="btn-{{this._id}}" style="background-color: #ffc107; color: #212529; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer;">
      ➕ Add to Cart
    </button>
  </form>
{{/if}}


    </div>
  {{/each}}
</div>
<script>
  async function addToCart(event, bookId) {
    event.preventDefault(); // Stop the form from submitting normally

    const button = document.getElementById(`btn-${bookId}`);

    try {
      const res = await fetch(`/add-to-cart/${bookId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      });

      if (res.ok) {
        // Change button appearance
        button.innerText = "✅ Added";
        button.style.backgroundColor = "#28a745";
        button.disabled = true;
      } else {
        alert("Failed to add to cart.");
      }
    } catch (err) {
      console.error("Error adding to cart:", err);
      alert("Something went wrong.");
    }

    return false;
  }
</script>

